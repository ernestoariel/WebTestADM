DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'Food.Dal.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201609091851257_InitialCreate'
BEGIN
    CREATE TABLE [dbo].[Diaries] (
        [DiaryId] [int] NOT NULL IDENTITY,
        [CurrentDate] [datetime] NOT NULL,
        [RowVersion] rowversion NOT NULL,
        [ApiUser_ApiUserId] [int],
        CONSTRAINT [PK_dbo.Diaries] PRIMARY KEY ([DiaryId])
    )
    CREATE INDEX [IX_ApiUser_ApiUserId] ON [dbo].[Diaries]([ApiUser_ApiUserId])
    CREATE TABLE [dbo].[ApiUsers] (
        [ApiUserId] [int] NOT NULL IDENTITY,
        [UserName] [nvarchar](max),
        [Password] [nvarchar](max),
        CONSTRAINT [PK_dbo.ApiUsers] PRIMARY KEY ([ApiUserId])
    )
    CREATE TABLE [dbo].[DiaryEntries] (
        [DiaryEntryId] [int] NOT NULL IDENTITY,
        [Quantity] [int] NOT NULL,
        [DiaryId] [int] NOT NULL,
        [FoodId] [int] NOT NULL,
        [MeasureId] [int] NOT NULL,
        [RowVersion] rowversion NOT NULL,
        CONSTRAINT [PK_dbo.DiaryEntries] PRIMARY KEY ([DiaryEntryId])
    )
    CREATE INDEX [IX_DiaryId] ON [dbo].[DiaryEntries]([DiaryId])
    CREATE INDEX [IX_FoodId] ON [dbo].[DiaryEntries]([FoodId])
    CREATE INDEX [IX_MeasureId] ON [dbo].[DiaryEntries]([MeasureId])
    CREATE TABLE [dbo].[Foods] (
        [FoodId] [int] NOT NULL IDENTITY,
        [Description] [nvarchar](max),
        [RowVersion] rowversion NOT NULL,
        CONSTRAINT [PK_dbo.Foods] PRIMARY KEY ([FoodId])
    )
    CREATE TABLE [dbo].[Measures] (
        [MeasureId] [int] NOT NULL IDENTITY,
        [Description] [nvarchar](max),
        [Calories] [int] NOT NULL,
        [TotalFat] [int],
        [SaturatedFat] [int],
        [Protein] [int],
        [Sugar] [int],
        [Sodium] [int],
        [RowVersion] rowversion NOT NULL,
        [FoodId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.Measures] PRIMARY KEY ([MeasureId])
    )
    CREATE INDEX [IX_FoodId] ON [dbo].[Measures]([FoodId])
    ALTER TABLE [dbo].[Diaries] ADD CONSTRAINT [FK_dbo.Diaries_dbo.ApiUsers_ApiUser_ApiUserId] FOREIGN KEY ([ApiUser_ApiUserId]) REFERENCES [dbo].[ApiUsers] ([ApiUserId])
    ALTER TABLE [dbo].[DiaryEntries] ADD CONSTRAINT [FK_dbo.DiaryEntries_dbo.Diaries_DiaryId] FOREIGN KEY ([DiaryId]) REFERENCES [dbo].[Diaries] ([DiaryId]) ON DELETE CASCADE
    ALTER TABLE [dbo].[DiaryEntries] ADD CONSTRAINT [FK_dbo.DiaryEntries_dbo.Foods_FoodId] FOREIGN KEY ([FoodId]) REFERENCES [dbo].[Foods] ([FoodId])
    ALTER TABLE [dbo].[DiaryEntries] ADD CONSTRAINT [FK_dbo.DiaryEntries_dbo.Measures_MeasureId] FOREIGN KEY ([MeasureId]) REFERENCES [dbo].[Measures] ([MeasureId])
    ALTER TABLE [dbo].[Measures] ADD CONSTRAINT [FK_dbo.Measures_dbo.Foods_FoodId] FOREIGN KEY ([FoodId]) REFERENCES [dbo].[Foods] ([FoodId])
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201609091851257_InitialCreate', N'Food.Dal.Migrations.Configuration',  0x1F8B0800000000000400DD5C5B6FE4B6157E2FD0FF20E8292D3633B6F72531661238E37561345E6F3D4E90378396E8B150899A8A94D783A2BF2C0FFD49FD0B2575A17895A8CB8CC7C1BE8C499EC3C373E139243FEDFF7EFFEFE2C7D724F65E6086A3142DFDD3D989EF4114A46184364B3F274FDF7EE7FFF8C39FFFB4F81426AFDEAFF5B88F6C1CA54478E93F13B23D9FCF71F00C138067491464294E9FC82C48933908D3F9D9C9C9F7F3D3D339A42C7CCACBF31677392251028B3FE89FAB1405704B7210DFA4218C71D54E7BD60557EF334820DE82002EFDAB340D679720F6BD8B380274FE358C9F7C0F20941240A874E7BF60B826598A36EB2D6D00F1FD6E0BE9B827106358497DDE0C775DC0C9195BC0BC21AC5905392669D293E1E9C74A2373957C905E7DAE31AAB34F54B764C7565DE86DE95F4620DBF99E3AD3F92ACED8A84AA785EA67C5D80F5ED3F2815B9D3A07FBF7C15BE531C933B844302719A023BEE48F7114FC1DEEEED37F42B444791C8B125199689FD4409BBE64E916666477079F4439AF43DF9BCBC473959AD3AA84E572AE11F978E67B9FA918E03186DCF4C2D2D724CDE0DF2082192030FC02088119B5DC75080BE569222813AEF22CA3232F29713D29FB7D4F7DDA306F3BAFBBF46BA5E19AD54F112A0CC6C2A29828D83153503B45AF90AEF206BCFE0CD1863C2FFDEF7CAF68ACFFAE661CB0F4559A6C730275ED7F062FD1A6205504BFD84634D432DFBB8371D18F9FA36D198FA51B3DF01157599ADCA5716DAABAE3619DE659C054989A7AEF41B681C45DA0829A7A7F16416C978A0DD83D5431A10826F4F1D925D9C401B5F0A2788B79137DAD31C955E31495D5E8378ACB6AF6219129901E2A36D97CEC573D23CD0534994951437F9AE3E617140545A4912CEF0CDC2F00E3AF69164E3C91B30B350ED9676F2F08DE72832F0418BCCB73EA43B9D33F72508D6B9FB19D8B63866A67C26C3696C70D04989A762C9B779BB4AA7D7F6C7230262E53F670958BD9B64BAC728C512AD6D52654D1DF57A6CA57BAC4E2C38C9255BD6DC2D5434CF239EF86A5729CF641F6F38D76C03A84FBEE7D6EA13FDDAE77097190455B2204F8DEF2E851EF25CEFEC7A3C0C905ABD16FE4854212E8EB88CEF9E37DFAE20AC469797C18931DEFE9CAE32B40142EED446B406DCD14D49790FE496084FA4D966F40D68F220DA33CE94572D4813D5179D53FA1D7D94ECDE662BB962DA5CE3E79F202E334880A19C40A881FCDE5D57C42A1D77A4E2FA38F1700D462748B8AB67453A2732FFDBF6AFAB171E4A7EB86233F12CB3C4F66B35375ADC2AA1C162B1675ADD2192B3C65C9D581ABE7BA8D170B1DCA3CF5D59DFC165DC21812E85D04E54DE30AE00084BA57526708E516BAF9437665158198061FA6E9244244CF14110AA22D883B4457E8FA5CE631E1F8346ACF25DC42C4B242875146CECFA75194D6A5A3617E57C4B98373C8713FA1D7497B86C0B8DC80549F53598E751C717617BB992BE4A16E232A75DCEC07701A2933D80C6B4E138D55791DEAEE2BC6E4721847314D7D202F3129F2E85DC470EC76D801B433F884BB8B7A78EF76C5E9F7184506172B5A8F4043771A45C7A36598DC99CAFA90D2104A0133C19B591B7C2586A32BADC7AAD32BAECE4FAA47309E6B4804F72C4E4F4D312A57389A47C9F455096862C0ABC30E16F22390598ECADF3B3831D5985894DB610771655B133D0F0B858560376539CD439A30C6F8D2A6BA515741CFC5166CA7F962570D2F30690CA856A4F2EA5C572EDDC75A166F2DEFDD0A7C45058DEF74E9C154D377EB739C264ADF6B55845E3D38559C23D520D50E02AF2A8846EB403E35EB0AB0D74EDDD593206E13B62DCB36D64B7B58B3E98EBDD5F4C692C0B52818E9006A1DE0A0D41695D4D7193C5DF1BEC5BCC404550D8BB9053CB4B801DB6D84360298A86AF1D6259268F5EDBA3FD8262979CC036CC0DC7069F94C24CDC0062ABDEC4A2A845751861982043C0276AFB40A136D98989C2DE9A69E49CEBFBAC5EA1C548F67BF9B34C7005533E30EDAA8ED8AAE2461A54F71CDA67A8B4EE731F4168841667B0A5DA5719EA08ED3BA9D8F84C11179491DEEFCC4DB4A919DD8AE735BCC15F568859CA67BEDAA4636A593A1799E1D64694BB5E0606B2BA54DAB02004454AA1552D2C6AB417688AC9A56774E0D7443E4D4B41E8D9DA59D7878549705EFC0D0B610B7C637876968416E817FB4716C201822B7A6D59DD3547B4F7D0720B2B1DD0BD8B908E73F9151CBB1D0CEEB5DED5E658134C89D4DF59D83239BC9F66B5EE9DD527238B1E30F6A625EF30DB2B2A5907530B495F2104138B5C59BD768A9BEE1ADEE9C9A17699153D3EACE497EA616B9C93D3D9271FD7E2DE5E2BAB18764E59BB62452D9D48347F5CA2D31A9DAF61DA9D3EC46FB8E77F9C866A8569ACB2A5B35D28C703A4AB0F3A6298FABF750BA2A0654A40F2D9569F1AC5A73EB2BA4F55E788242A555307A800CA3E209E11A3334034732F45ABD7A56D77D433BB2AB43B867F2A3BB72445F54C7E5EE8F80B4F37339C4F7A8125EA2909D9DD73B4C6032630366EB7FC5AB38A2B1D00CB801287A829894402AFFECE4F44CF9A2E878BEEE99631CC686EB06ED131FD96207FDE62662CAED047AF5C451193EB309E96F32CD673659FAF5A56EE9840EF59CCD104F829EB477966B14C2D7A5FFEF82FADCBBFEED4163F0C1BBCDA8DF9E7B27DE7F4471467C4060C6001DFC9390BDB88EFA15087A0159F00CB26F12F0FA9776FDE9CCD42F3D7A301BF235C7D030B61CAD877D59B117ABA81F5314938CFB94C235A02A325B180DF800C375E6926AD4C41AEAD6756E4E386AFA7DEE9DFD00FE0342631AC8FD5EC2C1806C1EB54F1D859DCCB89483E3D2DF85C154B8F990FD50059B2B3C5CC43041CF07B05180E843041161E943E82590FA000687AD120F944FA6C6864B07FCBEE06D4F7B3F1E022B1F8418B33F7BF52870BDDEF8B03EF3B55F3F1C1660E800983F3088DD043C188C661C0E3A7C03FCFB1F08F25E22787AC38BDFDEF696A7A73D43D88F1F93EC045B1F6D758E801A82753F7A7BDB1FBC8ECCD83D00E83D2C768CE1DEC72453A3C9DF0D7C5C07B2A96634A0B3EDF0F0F21A7FE9878F29357659D0DA70B42A6B5E816ACC9BE726037B2B62D9287AE57066F9AB4EDB226C884A23F0DC8A3B377137034E55B63CF634CEBCC7C4DC8ADEDC2F5E5D31A7843EEB84A4EA68D62305A4770B6ADD0BCD30AD23439B8BAEDC0071DE7A891381C9FB2F4E094109B1729478F11E02EFCD8A3DB0E0FA0332CD78C2FF3549532E8E360D0BF6388E6020E53A3EE61A3DA575D65524AA87689790048434115E64247A0201A1DD01C4B8F8AF2A7E05714E877C4A1E61788D6E73B2CD095D324C1E6349192C75B7CD5F00DE659917B7C58D249E620954CC88BDB1DEA29FF2280EB9DC57866B250B0B5613549764CC96845D966D769CD3E7143932AAD4C74B997B986C63CA0CDFA23578814364A3E9E367B801C1AEC601D899741B4256FB823AF7260309AE7834F4F44FEAC361F2FAC3FF01E454264772550000 , N'6.1.3-40302')
END

